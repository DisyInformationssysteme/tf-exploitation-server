//Copyright (c) 2014 by Disy Informationssysteme GmbH
package net.disy.eenvplus.tfes.modules.keyword.explanation;

import java.util.Collections;
import java.util.List;
import java.util.concurrent.Callable;

import net.disy.eenvplus.tfes.core.api.capabilities.ParameterDescription;
import net.disy.eenvplus.tfes.core.api.capabilities.ServiceModuleDescription;
import net.disy.eenvplus.tfes.core.api.modules.IDescriptionProviderServiceModule;
import net.disy.eenvplus.tfes.core.api.query.IDescribeConceptQuery;
import net.disy.eenvplus.tfes.core.api.response.IConceptDescription;
import net.disy.eenvplus.tfes.modules.core.ISparqlConnector;

import org.springframework.beans.factory.annotation.Autowired;

import com.hp.hpl.jena.query.Query;
import com.hp.hpl.jena.query.ResultSet;

// NOT_PUBLISHED

public class KeywordExplanationModule implements IDescriptionProviderServiceModule {

  @Autowired
  private ISparqlConnector sparqlConnector;

  @Autowired
  private DescribeContextResultSetMapper resultSetMapper;

  @Autowired
  private ExplanationQueryFactory queryFactory;

  static final String SERVICE_ID = "Keyword Explanation Module"; //$NON-NLS-1$

  @Override
  public ServiceModuleDescription getDescription() {
    List<ParameterDescription> parameterDescriptions = Collections.emptyList();
    return new ServiceModuleDescription(SERVICE_ID, parameterDescriptions);
  }

  @Override
  public Callable<IConceptDescription> getDescribeConcept(final IDescribeConceptQuery query) {
    return new Callable<IConceptDescription>() {

      @Override
      public IConceptDescription call() throws Exception {
        Query jenaQuery = queryFactory.createQuery(query);
        ResultSet result = sparqlConnector.executeSparqlQuery(jenaQuery);
        return resultSetMapper.map(result);
      }
    };
  }

}
