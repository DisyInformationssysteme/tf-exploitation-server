//Copyright (c) 2014 by Disy Informationssysteme GmbH
package net.disy.eenvplus.tfes.modules.configuration;

import static org.apache.commons.lang3.StringUtils.equalsIgnoreCase;

import java.util.Map;

import org.springframework.context.annotation.Condition;
import org.springframework.context.annotation.ConditionContext;
import org.springframework.core.env.Environment;
import org.springframework.core.type.AnnotatedTypeMetadata;

// NOT_PUBLISHED
public class OnEnvironmentPropertyCondition implements Condition {

  @Override
  public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
    Map<String, Object> attributes = metadata
        .getAnnotationAttributes(ConfiguredByEnvironmentProperty.class.getName());
    Environment environment = context.getEnvironment();

    String property = (String) attributes.get("value"); //$NON-NLS-1$

    return isConfigured(environment, property);
  }

  private boolean isConfigured(Environment environment, String property) {
    return equalsIgnoreCase("true", environment.getProperty(property)); //$NON-NLS-1$
  }

}
