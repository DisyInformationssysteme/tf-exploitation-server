//Copyright (c) 2014 by Disy Informationssysteme GmbH
package net.disy.eenvplus.tfes.web.validation.impl;

import static net.disy.eenvplus.tfes.web.api.core.RestMethodParameters.CONCEPT;
import static net.disy.eenvplus.tfes.web.api.exceptions.ErrorResponseCodes.MISSING_PARAMETER;
import static org.apache.commons.lang3.StringUtils.isBlank;
import static org.apache.commons.lang3.StringUtils.trim;
import net.disy.eenvplus.tfes.core.api.query.IConceptQuery;
import net.disy.eenvplus.tfes.core.api.service.IServiceManager;
import net.disy.eenvplus.tfes.web.endpoint.core.IllegalQueryArgumentException;

import org.springframework.beans.factory.annotation.Autowired;

// NOT_PUBLISHED
public abstract class AbstractConceptQueryValidator<Q extends IConceptQuery>
    extends
    AbstractServiceQueryValidator<Q> {

  @Autowired
  private IServiceManager serviceManager;

  public AbstractConceptQueryValidator() {
    super();
  }

  @Override
  public boolean validate(Q query) {
    return super.validate(query) && validateConcept(query);
  }

  private boolean validateConcept(IConceptQuery query) throws IllegalQueryArgumentException {
    String concept = query.getConcept();
    String trimmed = trim(concept);
    if (isBlank(trimmed)) {
      throw new IllegalQueryArgumentException(MISSING_PARAMETER, CONCEPT);
    }
    return true;
  }

  protected IServiceManager getServiceManager() {
    return serviceManager;
  }
}