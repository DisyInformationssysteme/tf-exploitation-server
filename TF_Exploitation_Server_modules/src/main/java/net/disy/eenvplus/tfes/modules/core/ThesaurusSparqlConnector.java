//Copyright (c) 2014 by Disy Informationssysteme GmbH
package net.disy.eenvplus.tfes.modules.core;

import net.disy.eenvplus.tfes.core.api.exceptions.ServiceException;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.stereotype.Component;

import com.hp.hpl.jena.query.Query;
import com.hp.hpl.jena.query.QueryExecution;
import com.hp.hpl.jena.query.QueryExecutionFactory;
import com.hp.hpl.jena.query.ResultSet;
import com.hp.hpl.jena.sparql.engine.http.QueryExceptionHTTP;

// NOT_PUBLISHED
@Component
public class ThesaurusSparqlConnector implements ISparqlConnector {

  @Value("${sparql.endpoint.url}")
  private String sparqlEndpointUrl;
  private static final Logger LOGGER = LoggerFactory.getLogger(ThesaurusSparqlConnector.class);

  @Override
  public ResultSet executeSparqlQuery(Query query) throws ServiceException {
    LOGGER.debug("Executing SparQl-Query:\n" + query.toString()); //$NON-NLS-1$
    QueryExecution queryExecution = QueryExecutionFactory.sparqlService(sparqlEndpointUrl, query);
    try {
      ResultSet result = queryExecution.execSelect();
      return result;
    }
    catch (QueryExceptionHTTP exception) {
      LOGGER
          .error("Error in Request to SPARQL endpoint. Response-Code: " + exception.getResponseCode()); //$NON-NLS-1$

      throw SparqlExceptionFactory.wrap(sparqlEndpointUrl, exception);
    }
  }

  @Override
  public String getEndpointUrl() {
    return sparqlEndpointUrl;
  }

}
